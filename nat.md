# π” NAT μ™„μ „ μ •λ³µ: IP μ£Όμ† κ³ κ°μ„ λ§‰κ³  λ‚΄λ¶€ λ„¤νΈμ›ν¬λ¥Ό λ³΄νΈν•λ” ν•µμ‹¬ κΈ°μ 

> μ‚¬μ„¤ IPλ΅ μΈν„°λ„·μ— μ ‘μ†ν•  μ μλ” λΉ„λ°€μ€?
> NATμ μ›λ¦¬λ¶€ν„° SNAT/DNAT, PAT, μ‹¤λ¬΄ κµ¬μ„±κ³Ό λ³΄μ•κΉμ§€ μ™„λ²½ ν•΄μ„¤!

---

## π“ 1. NATλ€?

\*\*NAT(Network Address Translation)\*\*μ€ λ‚΄λ¶€ λ„¤νΈμ›ν¬μ **μ‚¬μ„¤ IP μ£Όμ†**λ¥Ό **κ³µμΈ IP μ£Όμ†λ΅ λ³€ν™**ν•μ—¬ μΈν„°λ„· ν†µμ‹ μ΄ κ°€λ¥ν•λ„λ΅ λ§λ“λ” κΈ°μ μ…λ‹λ‹¤.

> μ¦‰, NATλ” IP ν¨ν‚·μ \*\*IP μ£Όμ†(λ° ν¬νΈ)\*\*λ¥Ό μ¤‘κ°„ μ¥λΉ„(λ³΄ν†µ κ³µμ κΈ° λλ” λΌμ°ν„°)μ—μ„ **μ‹¤μ‹κ°„μΌλ΅ λ³€ν™**ν•΄μ£Όλ” μ—­ν• μ„ ν•©λ‹λ‹¤.
<img src="./images/nat.png" width=90% /><br>

---

## π 2. μ™ NATκ°€ ν•„μ”ν•κ°€?

### π§  λ¬Έμ : IPv4 μ£Όμ† κ³ κ°

* IPv4λ” **32λΉ„νΈ** β†’ μ•½ **43μ–µ κ° μ£Όμ†**
* μΈν„°λ„· μ‚¬μ©μ, IoT μ¥μΉ κΈ‰μ¦ β†’ **κ³µμΈ IP λ¶€μ΅±**

### π› οΈ ν•΄κ²°: μ‚¬μ„¤ IP + NAT

| κ°λ…        | μ„¤λ…                             |
| --------- | ------------------------------ |
| **μ‚¬μ„¤ IP** | λ‚΄λ¶€μ—μ„λ§ ν†µμ©λλ” λΉ„κ³µκ° IP μ£Όμ†           |
| **κ³µμΈ IP** | μ „ μ„Έκ³„μ—μ„ μ μΌν• μ£Όμ†, μΈν„°λ„· ν†µμ‹ μ— μ‚¬μ©      |
| **NAT**   | μ‚¬μ„¤ β†” κ³µμΈ μ£Όμ†λ¥Ό λ³€ν™ν•μ—¬ μ™Έλ¶€μ™€ ν†µμ‹  κ°€λ¥ν•κ² ν•¨ |

---

## π§± 3. NAT λ™μ‘ μ›λ¦¬

### π”„ κΈ°λ³Έ νλ¦„

```text
λ‚΄λ¶€ PC (192.168.0.2)
   β†“
[λΌμ°ν„°: NAT μν–‰]
   β†“
κ³µμΈ IP (203.0.113.1)
   β†“ μΈν„°λ„·
```

* **μ¶λ°μ§€ IP λ³€κ²½**: λ‚΄λ¶€ β†’ μ™Έλ¶€
* **λ„μ°©μ§€ IP λ³€κ²½**: μ™Έλ¶€ β†’ λ‚΄λ¶€ (μ‘λ‹µ ν¨ν‚· μ‹)

> NAT μ¥λΉ„λ” \*\*"μ—°κ²° ν…μ΄λΈ”"\*\*μ„ μ μ§€ν•μ—¬ μ–΄λ–¤ λ‚΄λ¶€ IPμ™€ ν¬νΈκ°€ μ–΄λ–¤ μ™Έλ¶€ IP/ν¬νΈλ΅ λ§¤ν•‘λμ—λ”μ§€ κ΄€λ¦¬ν•¨.

---

## π” 4. NATμ μ ν•

### β… 4.1 Static NAT (μ •μ  NAT)

* **λ‚΄λ¶€ IP β†” κ³µμΈ IP** 1:1 κ³ μ • λ§¤ν•‘
* λ‚΄λ¶€ μ„λ²„λ¥Ό μ™Έλ¶€μ— κ³ μ • μ£Όμ†λ΅ λ…Έμ¶

| λ‚΄λ¶€ IP        | κ³µμΈ IP        |
| ------------ | ------------ |
| 192.168.0.10 | 203.0.113.10 |

> μ‚¬μ© μ: μ‚¬λ‚΄ μ›Ήμ„λ²„, λ©”μΌμ„λ²„ μ™Έλ¶€ κ³µκ°

---

### π” 4.2 Dynamic NAT (λ™μ  NAT)

* μ‚¬μ„¤ IP β†” κ³µμΈ IP \*\*ν’€(pool)\*\*μ„ κΈ°λ°μΌλ΅ **ν•„μ”ν•  λ• ν• λ‹Ή**
* κ³µμΈ IP μκ°€ μ ν•μ μΌ λ• μ‚¬μ©

> π“ λ‹¨μ : λ™μ‹μ— μ ‘μ†ν•λ” μ¥μΉ μκ°€ κ³µμΈ IP μλ³΄λ‹¤ λ§μΌλ©΄ **μ ‘μ† λ¶κ°€**

---

### π”€ 4.3 PAT (Port Address Translation) λλ” NAT Overload

* ν•λ‚μ κ³µμΈ IPμ— **ν¬νΈ λ²νΈκΉμ§€ μ¶”κ°€λ΅ λ§¤ν•‘** β†’ μμ² λ€ μ¥μΉ μΈν„°λ„· μ‚¬μ© κ°€λ¥

```text
192.168.0.2:45678 β†’ 203.0.113.1:10001
192.168.0.3:45679 β†’ 203.0.113.1:10002
```

| λ‚΄λ¶€ IP:ν¬νΈ          | κ³µμΈ IP:ν¬νΈ          |
| ----------------- | ----------------- |
| 192.168.0.2:45678 | 203.0.113.1:10234 |
| 192.168.0.3:45679 | 203.0.113.1:10235 |

> κ°€μ¥ **λ³΄νΈμ μΌλ΅ μ‚¬μ©λλ” NAT λ°©μ‹** (κ°€μ •μ© κ³µμ κΈ°, νμ‚¬ NAT λΌμ°ν„° λ“±)

---

### β†”οΈ 4.4 SNAT vs DNAT

| κµ¬λ¶„    | SNAT (Source NAT) | DNAT (Destination NAT) |
| ----- | ----------------- | ---------------------- |
| λ©μ     | **μ¶λ°μ§€ IP λ³€ν™**     | **λ„μ°©μ§€ IP λ³€ν™**          |
| μμ‹    | λ‚΄λ¶€ μ‚¬μ©μκ°€ μΈν„°λ„· μ ‘μ†    | μ™Έλ¶€ μ‚¬μ©μκ°€ λ‚΄λ¶€ μ„λ²„μ— μ ‘μ†      |
| μ‚¬μ© μ„μΉ | λ‚΄λ¶€ β†’ μ™Έλ¶€           | μ™Έλ¶€ β†’ λ‚΄λ¶€                |

---

## π” 5. NATμ™€ λ³΄μ•

### β”οΈ μ¥μ 

| ν•­λ©       | μ„¤λ…                               |
| -------- | -------------------------------- |
| IP μ£Όμ† μ μ•½ | μμ² λ€μ μ¥μΉλ¥Ό ν•λ‚μ κ³µμΈ IPλ΅ μΈν„°λ„· μ—°κ²° κ°€λ¥   |
| λ‚΄λ¶€ λ³΄νΈ    | μ™Έλ¶€μ—μ„ μ‚¬μ„¤ IP μ§μ ‘ μ ‘κ·Ό λ¶κ°€ (μΌμΆ…μ λ°©ν™”λ²½ ν¨κ³Ό) |
| κ°„μ ‘ μ—°κ²°    | ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ λ¨λΈμ—μ„ μ μ—°ν• μ„¤μ • κ°€λ¥          |

### β οΈ λ‹¨μ 

| ν•­λ©        | μ„¤λ…                            |
| --------- | ----------------------------- |
| μ„λ²„ νΈμ¤ν… λ¶νΈ | μ™Έλ¶€μ—μ„ λ‚΄λ¶€λ΅ μ§μ ‘ μ ‘μ† μ–΄λ ¤μ›€ (ν¬νΈν¬μ›λ”© ν•„μ”) |
| P2P ν†µμ‹  μ ν• | μ—°κ²° μ£Όλ„κ¶μ΄ μ™Έλ¶€μ—μ„ λ‚΄λ¶€λ΅ κ° μ μ—†μ       |
| μ„±λ¥ μ¤λ²„ν—¤λ“   | ν¬νΈ λ§¤ν•‘ ν…μ΄λΈ” μ μ§€/λ³€ν™ λΉ„μ© μ΅΄μ¬         |
| λ³΄μ• μ°©κ°     | NATμ€ λ³΄μ• κΈ°λ¥μ΄ μ•„λ‹. **μ¶”κ°€ λ°©ν™”λ²½ ν•„μ”** |

---

## π› οΈ 6. μ‹¤λ¬΄ κµ¬μ„± μμ 

### π“¦ ν¬νΈ ν¬μ›λ”© (DNAT)

* λ‚΄λ¶€ μ›Ήμ„λ²„(192.168.0.100:80)λ¥Ό κ³µμΈ IP 203.0.113.1μ ν¬νΈ 8080μΌλ΅ μ—°κ²°

```bash
# λ¦¬λ…μ¤ iptables μμ‹
iptables -t nat -A PREROUTING -p tcp --dport 8080 \
  -j DNAT --to-destination 192.168.0.100:80
```

---

## π” 7. NAT λ™μ‘ μμ‹ (PAT κΈ°μ¤€)

```text
λ‚΄λ¶€:
PC1 β†’ 192.168.0.2:45678 β†’ NAT β†’ 203.0.113.1:10001
PC2 β†’ 192.168.0.3:45679 β†’ NAT β†’ 203.0.113.1:10002

μΈν„°λ„· μ‘λ‹µ μμ‹ :
203.0.113.1:10001 β†’ NAT ν…μ΄λΈ” μ΅°ν β†’ 192.168.0.2:45678
```

---

## π§  8. NATκ³Ό κ΄€λ ¨λ μ£Όμ” κ°λ…

| μ©μ–΄                | μ„¤λ…                                       |
| ----------------- | ---------------------------------------- |
| **NAT Table**     | λ‚΄λ¶€ β†” μ™Έλ¶€ IP/ν¬νΈ λ§¤ν•‘ μ •λ³΄ ν…μ΄λΈ”                  |
| **Timeout**       | μΌμ • μ‹κ°„ μ΄μƒ μ‘λ‹µ μ—†μΌλ©΄ λ§¤ν•‘ μ‚­μ                     |
| **Hairpin NAT**   | λ™μΌ NAT λ‚΄λ¶€μ—μ„ κ³µμΈ IPλ΅ μ ‘μ† κ°€λ¥ν•κ² ν—μ©            |
| **NAT Traversal** | P2P μ—°κ²°μ„ μ„ν• NAT μ°ν κΈ°μ  (STUN, TURN, ICE λ“±) |

---

## π“ μ°Έκ³  μλ£

* [RFC 3022 - Traditional NAT](https://datatracker.ietf.org/doc/html/rfc3022)
* [Cisco NAT Configuration Guide](https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/ipaddr_nat/configuration)
* Wiresharkλ¥Ό ν†µν• NAT ν¨ν‚· λ¶„μ„ μμ 

---

## β… μ”μ•½ μ •λ¦¬

| ν•­λ©    | μ„¤λ…                                          |
| ----- | ------------------------------------------- |
| λ©μ     | μ‚¬μ„¤ IP μ£Όμ†λ¥Ό κ³µμΈ IPλ΅ λ³€ν™                         |
| ν•µμ‹¬ μ—­ν•  | μ£Όμ† μ μ•½, λ‚΄λ¶€ λ„¤νΈμ›ν¬ λ³΄νΈ                           |
| μ£Όμ” λ°©μ‹ | Static NAT, Dynamic NAT, PAT (NAT Overload) |
| ν™•μ¥ κ°λ… | SNAT, DNAT, Port Forwarding, NAT Traversal  |
| μ‹¤λ¬΄ κµ¬μ„± | ν™ κ³µμ κΈ°, κΈ°μ—… λΌμ°ν„°, ν΄λΌμ°λ“ λ„¤νΈμ›ν¬ κµ¬μ„± ν•„μ κΈ°μ            |

