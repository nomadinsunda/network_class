# 🌐 IP 프로토콜 완전 정복: 인터넷의 주소 체계와 패킷 전달의 핵심

> 인터넷은 어떻게 목적지까지 데이터를 정확히 보내는가?
> IP 프로토콜의 구조, 주소 체계(Public & Private IP 포함), 라우팅, 단편화, 보안까지 완전 정복해보자.

---

## 🔍 1. IP란?

\*\*IP(Internet Protocol)\*\*는 네트워크 상에서 데이터를 **패킷 단위**로 전송하기 위한 **네트워크 계층(OSI Layer 3)** 프로토콜입니다.

| 핵심 역할 | 설명                      |
| ----- | ----------------------- |
| 주소 지정 | 각 장치에 고유한 IP 주소 할당      |
| 패킷 전달 | 목적지까지 패킷을 경유 라우터를 통해 전달 |
| 단편화   | 전송 경로상의 MTU보다 큰 패킷을 분할  |

---

## 🧱 2. IP 주소 구조

### ✅ IPv4

* **32비트**: 4바이트 (예: `192.168.1.1`)
* **네트워크 부분 + 호스트 부분**으로 구성
* **서브넷 마스크**와 함께 사용

```text
IP:        192.168.1.100
Subnet:    255.255.255.0
Network:   192.168.1.0
Broadcast: 192.168.1.255
```

### ✅ IPv6

* **128비트**: 확장성과 보안 개선
* 표현 예시: `2001:0db8:85a3::8a2e:0370:7334`

---

## 🌐 3. Public IP vs Private IP

### 📘 Public IP (공인 IP 주소)

* **인터넷 상에서 전 세계적으로 유일**
* 전 세계 라우팅 가능
* **ISP가 유료로 할당**
* 인터넷 서버, 라우터 외부 인터페이스에 주로 사용

> 예: `8.8.8.8`, `1.1.1.1`, `203.246.112.1`

### 📗 Private IP (사설 IP 주소)

* **내부 네트워크에서만 사용**, 외부 인터넷에서는 사용 불가
* RFC 1918에 의해 정의된 범위:

| 클래스 | 범위                             |
| --- | ------------------------------ |
| A   | 10.0.0.0 \~ 10.255.255.255     |
| B   | 172.16.0.0 \~ 172.31.255.255   |
| C   | 192.168.0.0 \~ 192.168.255.255 |

> ⚠️ 같은 사설 IP를 여러 네트워크에서 동시에 사용해도 충돌 없음

---

## 🔁 4. NAT와 IP 주소 고갈

IPv4 주소는 약 43억 개로 제한되어 있음 → 전 세계 모든 장치에 Public IP 제공은 불가능

### 해결책: NAT(Network Address Translation)

* 하나의 **Public IP**로 여러 사설 IP 장치가 인터넷 공유 가능
* 라우터가 내부 IP ↔ 외부 IP 변환

```text
[내부 PC] 192.168.0.2
   ↓ NAT 변환
[라우터] 203.246.112.1 (공인 IP)
   ↓
[인터넷]
```

---

## 🧭 5. IP 패킷 전송 과정 요약

```text
[PC A] → [라우터] → [인터넷] → [라우터] → [PC B]
```

1. 목적지 IP 주소에 기반해 라우팅 경로 설정
2. 각 홉(hop, 라우터)을 지날 때 **TTL** 감소
3. 최종 목적지에서 패킷 수신

---

## 📦 6. IPv4 헤더 구조

```text
0                   15                  31
+------------------+--------------------+
| Version | IHL    | Type of Service    |
+------------------+--------------------+
| Total Length                     |
+----------------------------------+
| Identification | Flags | Fragment     |
+------------------+--------------------+
| TTL | Protocol | Header Checksum     |
+------------------+--------------------+
| Source IP Address                |
+----------------------------------+
| Destination IP Address           |
+----------------------------------+
```

| 필드         | 설명                               |
| ---------- | -------------------------------- |
| Version    | IPv4는 4                          |
| TTL        | 최대 홉 수. 라우터 지날 때마다 -1            |
| Protocol   | 상위 계층 식별 (TCP=6, UDP=17, ICMP=1) |
| Src/Dst IP | 발신자 / 수신자 IP 주소                  |

---

## ✂️ 7. IP 단편화(Fragmentation)

* MTU보다 큰 패킷은 조각(프래그먼트)으로 분리
* **수신지에서 재조립**
* 조각화는 **네트워크 성능 저하**를 유발할 수 있어 가급적 회피

---

## 🔐 8. 보안 이슈

| 위험               | 설명                    |
| ---------------- | --------------------- |
| IP Spoofing      | 출발지 IP를 위조하여 공격 탐지 회피 |
| Fragmentation 공격 | 방화벽 탐지 우회 목적          |
| DoS/DDoS         | 특정 IP 대상 대량 트래픽 유발    |

### ✅ 대응 방안

* Ingress/Egress 필터링
* IPS/IDS 탐지 설정
* Stateless/Stateful Firewall 규칙 구성

---

## 🛠️ 9. 실무 명령어

```bash
# 현재 IP 확인
ip addr show        # Linux
ipconfig            # Windows

# 라우팅 테이블 확인
ip route
route print         # Windows

# 외부 공인 IP 확인 (공유기 뒤일 경우)
curl ifconfig.me
curl ipinfo.io/ip
```

---

## 📚 참고자료

* [RFC 791 - Internet Protocol](https://datatracker.ietf.org/doc/html/rfc791)
* [RFC 1918 - Private Address Allocation](https://datatracker.ietf.org/doc/html/rfc1918)
* [IANA IPv4 Special-Purpose Address Registry](https://www.iana.org/assignments/iana-ipv4-special-registry/)

---

## ✅ 요약

| 항목         | 설명                                      |
| ---------- | --------------------------------------- |
| IP 주소      | 네트워크 상의 논리 주소 (IPv4: 32비트, IPv6: 128비트) |
| Public IP  | 인터넷 라우팅 가능한 전역 고유 주소                    |
| Private IP | 내부 네트워크 전용 비공개 주소 (NAT로 변환)             |
| NAT        | 여러 사설 IP가 하나의 공인 IP를 공유                 |
| 기능         | 주소 지정, 라우팅, 단편화, 프로토콜 식별                |
| 문제         | IP 고갈, 스푸핑, 프래그먼트 공격 등                  |


